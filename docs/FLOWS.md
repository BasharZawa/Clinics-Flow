# JoClinicsFlows - نظام إدارة العيادات

## نظرة عامة
نظام SaaS لإدارة العيادات والمراكز التجميلية مع التركيز على:
- حجز المواعيد المتكررة (حزم الليزر، جلسات العناية)
- قائمة الانتظار الذكية
- التكامل مع WhatsApp كميزة تنافسية

---

## المستخدمون والأدوار

### 1. Super Admin (أنت/مطور النظام)
- إدارة العيادات المشتركة
- الإشتراكات والفوترة
- مراقبة النظام

### 2. Clinic Admin (صاحب العيادة)
- إدارة الموظفين (أطباء، فنيين، سكرتارية)
- إدارة الخدمات والأسعار
- التقارير المالية
- الإعدادات

### 3. Doctor (طبيب)
- عرض جدول مواعيده فقط
- كتابة ملاحظات للمرضى
- تأكيد حضور المريض

### 4. Technician (فني ليزر/عناية بالبشرة)
- عرض جدول مواعيده فقط
- تحديث حالة الجلسة (مكتملة، ملغاة)
- ملاحظات الجلسة

### 5. Secretary (سكرتيرة)
- حجز مواعيد جديدة
- إدارة قائمة الانتظار
- إرسال تذكيرات يدوية
- تسجيل حضور/غياب

### 6. Patient (مريض)
- عرض مواعيده القادمة
- طلب حجز جديد
- الإلغاء/إعادة الجدولة
- سجل علاجاته

---

## سير العمل الرئيسي (Core Flows)

### Flow 1: حجز موعد جديد (السكرتيرة)
```
السكرتيرة تفتح Dashboard → Calendar View
    ↓
تختار تاريخ ووقت فارغ
    ↓
تدخل بيانات المريض (جديد/موجود)
    ↓
تختار الخدمة
    ↓
تختار الطبيب/الفني المناسب
    ↓
تحدد إذا كان الموعد:
    - مرة واحدة (One-time)
    - متكرر (Recurring Package) → مثال: 6 جلسات ليزر، كل 4 أسابيع
    ↓
تحفظ الموعد
    ↓
[NEXT] إرسال تأكيد WhatsApp للمريض
```

### Flow 2: حجز عبر WhatsApp (المريض)
```
المريض يرسل "بدي حجز" على WhatsApp
    ↓
البوت يرد:
    "أهلاً! اختار الخدمة:
    1️⃣ ليزر إزالة شعر
    2️⃣ تنظيف بشرة
    3️⃣ استشارة دكتور"
    ↓
المريض يرد برقم
    ↓
البوت يرسل الأيام المتاحة (3-5 أيام قادمة)
    ↓
المريض يختار يوم
    ↓
البوت يرسل الأوقات المتاحة
    ↓
المريض يختار وقت
    ↓
البوت يطلب الاسم ورقم الهاتف (لو جديد)
    ↓
[BOOKING_CREATED] → قائمة الانتظار للتأكيد
    ↓
السكرتيرة تؤكد من Dashboard
    ↓
إرسال تأكيد نهائي للمريض
```

### Flow 3: قائمة الانتظار الذكية
```
مريض يلغي موعد (عبر واتساب أو السكرتيرة)
    ↓
النظام يبحث تلقائياً في قائمة الانتظار:
    - نفس الخدمة
    - نفس الطبيب/الفني
    - نفس اليوم أو الأيام القريبة
    ↓
إذا وجد مطابق:
    → إرسال WhatsApp للمريض في قائمة الانتظار
    → "موعد متاح الساعة X يوم Y. تبيه؟ رد بـ 'نعم'"
    ↓
إذا رد المريض "نعم" خلال 10 دقائق:
    → تأكيد الحجز تلقائياً
    → إشعار للسكرتيرة
    → إلغاء الموعد الأصلي

إذا ما رد أو رفض:
    → الموعد يصبح متاح للحجز العام
```

### Flow 4: التذكيرات التلقائية
```
[Cron Job - يومي الساعة 9:00 صباحاً]
    ↓
جلب مواعيد الغد (24 ساعة)
    ↓
إرسال تذكير WhatsApp:
    "تذكير: عندك موعد غداً الساعة [الوقت]
    الخدمة: [الاسم]
    العيادة: [العنوان]
    
    للإلغاء رد بـ 'إلغاء'"
    ↓
[Cron Job - كل ساعة]
    ↓
جلب مواعيد بعد ساعة
    ↓
إرسال تذكير WhatsApp:
    "تذكير: موعدك بعد ساعة! ⏰"
```

### Flow 5: الحزم المتكررة (Packages)
```
السكرتيرة تنشئ حزمة لمريض:
    - نوع الخدمة: ليزر
    - عدد الجلسات: 6
    - الفاصل الزمني: كل 4 أسابيع
    - الفني المسؤول: أحمد
    ↓
النظام ينشئ 6 مواعيد تلقائياً:
    الجلسة 1: اليوم المحدد
    الجلسة 2: +4 أسابيع
    الجلسة 3: +8 أسابيع
    ...
    ↓
كل موعد له حالة منفصلة
    ↓
إذا ألغى مريض جلسة واحدة:
    → إعادة جدولة تلك الجلسة فقط
    → بقية الجلسات على موعدها
```

---

## الحالات (Status States)

### الموعد (Appointment)
- `PENDING` - قيد الانتظار (من WhatsApp، لم تؤكد بعد)
- `CONFIRMED` - مؤكد
- `COMPLETED` - تم الحضور والإنجاز
- `NO_SHOW` - لم يحضر
- `CANCELLED_BY_PATIENT` - ملغى من المريض
- `CANCELLED_BY_CLINIC` - ملغى من العيادة

### قائمة الانتظار (Waitlist)
- `ACTIVE` - في الانتظار
- `FILLED` - تم تعبئة الموعد
- `EXPIRED` - مر تاريخ التفضيل
- `CANCELLED` - ألغى المريض طلبه

### الحزمة (Package)
- `ACTIVE` - نشطة
- `COMPLETED` - اكتملت جميع الجلسات
- `CANCELLED` - ملغاة
- `PAUSED` - موقوفة مؤقتاً

---

## الميزات المستقبلية (V2)
- [ ] دفع إلكتروني (حجز مسبق)
- [ ] صور قبل/بعد للعلاجات
- [ ] تقييم المرضى للخدمة
- [ ] تكامل مع Google Calendar
- [ ] تطبيق موبايل (PWA)
- [ ] نظام نقاط ولاء
